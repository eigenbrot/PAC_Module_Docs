
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Quality Assurance of PA&amp;C Outputs &#8212; PAC_Pipeline v0.9.2</title>
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Open+Sans:400,600,700" />
    <link rel="stylesheet" type="text/css" href="_static/dkist.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="_static/favico.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Computation of M12 Parameters" href="M12.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head><body>


  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="col-md-3 navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://nso.edu"><img src="_static/img/NSOlogo.gif">
        </a>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav hidden">
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">PA&amp;C Module Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="cupar.html">Fitting of Calibration Unit Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="demod.html">Computation of Demodulation Matrices</a></li>
<li class="toctree-l1"><a class="reference internal" href="tele.html">Computation of Telescope M3-6 Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="M12.html">Computation of M12 Parameters</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Quality Assurance of PA&amp;C Outputs</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Quality Assurance of PA&amp;C Outputs</a><ul>
<li><a class="reference internal" href="#parameter-uncertainties">Parameter Uncertainties</a><ul>
<li><a class="reference internal" href="#example-usage">Example Usage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#demodulation-matrix-uncertainties">Demodulation Matrix Uncertainties</a><ul>
<li><a class="reference internal" href="#id1">Example Usage</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="M12.html" title="Previous Chapter: Computation of M12 Parameters"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Computation o...</span>
    </a>
  </li>
              
            
            
            
            
          </ul>
          
            <ul class="nav navbar-nav navbar-left">
              <li><a href="http://dkist.nso.edu/">DKIST</a></li>
              <li><a href="http://docs.cadair.com/devdocs">DC Developer Guide</a></li>
              <li><a href="http://docs.cadair.com/datarate">DKIST Data Rate</a></li>
              <li><a href="http://docs.cadair.com/datamodel">DKIST Data Model</a></li>
            </ul>
          
          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          

        </div>
    </div>
  </div>

<div class="container">
  <div class="row">

    <div class="col-md-3"><div id="side-logo" >
            <a href="http://dkist.nso.edu">
                <img src="_static/img/DKISTLogo-Medium.jpg">
            </a>
        </div><div id="sidebar" class="bs-sidenav" role="complementary">
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">PA&amp;C Module Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="cupar.html">Fitting of Calibration Unit Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="demod.html">Computation of Demodulation Matrices</a></li>
<li class="toctree-l1"><a class="reference internal" href="tele.html">Computation of Telescope M3-6 Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="M12.html">Computation of M12 Parameters</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Quality Assurance of PA&amp;C Outputs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#parameter-uncertainties">Parameter Uncertainties</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#example-usage">Example Usage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#demodulation-matrix-uncertainties">Demodulation Matrix Uncertainties</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">Example Usage</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
        </div>
    </div>

    <div class="col-md-9 content">
      
  <div class="section" id="quality-assurance-of-pa-c-outputs">
<h1>Quality Assurance of PA&amp;C Outputs<a class="headerlink" href="#quality-assurance-of-pa-c-outputs" title="Permalink to this headline">¶</a></h1>
<p>The current suite of QA routines perform two functions: estimating the uncertainty on fit telescope/CU parameters and
generating an uncertainty matrix that pairs with the demodulation matrix output by <code class="xref py py-obj docutils literal notranslate"><span class="pre">pac_demod</span></code>.</p>
<div class="section" id="parameter-uncertainties">
<h2>Parameter Uncertainties<a class="headerlink" href="#parameter-uncertainties" title="Permalink to this headline">¶</a></h2>
<p>Due to the extremely complicated <span class="math notranslate nohighlight">\(\chi^2\)</span> space, uncertainties on the fit parameters (either CU or M3-6) are
computed via Markov-Chain Monte Carlo (MCMC) methods. To run MCMC analysis the saved fitting statistics must have been
saved during the initial fit by passing the <code class="docutils literal notranslate"><span class="pre">-S</span></code> option to either <code class="xref py py-obj docutils literal notranslate"><span class="pre">pac_demod</span></code> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">pac_tele</span></code>. If generated, the
fitting stats will be saved in a directory called “fitaux”, which can be used by the <code class="xref py py-obj docutils literal notranslate"><span class="pre">pac_mcmc</span></code> program:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">pac_mcmc [-h] [-b BURN] [-N NUM_STEPS] [-w NUM_WALKERS] aux_dir</span>
</pre></div>
</div>
<p>with options</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">aux_dir:</th><td class="field-body">The directory containing fitting statistics. Probably called “fitaux”</td>
</tr>
<tr class="field-even field"><th class="field-name">-h:</th><td class="field-body">Display help and exit</td>
</tr>
<tr class="field-odd field"><th class="field-name">-b INT:</th><td class="field-body">Burn the first INT steps of the MCMC sample chain. Useful to let MCMC walkers fill out parameter space before doing analysis.</td>
</tr>
<tr class="field-even field"><th class="field-name">-N INT:</th><td class="field-body">Specify number of steps each MCMC walker will take</td>
</tr>
<tr class="field-odd field"><th class="field-name">-w INT:</th><td class="field-body">Specify the number of MCMC walkers to use</td>
</tr>
</tbody>
</table>
<p>The output consists of a python pickle file and a set of MCMC analysis plots for each detector position found in
<code class="docutils literal notranslate"><span class="pre">aux_dir</span></code>. These files will be saved in the same <code class="docutils literal notranslate"><span class="pre">aux_dir</span></code> given as input to <code class="xref py py-obj docutils literal notranslate"><span class="pre">pac_mcmc</span></code>.</p>
<div class="section" id="example-usage">
<h3>Example Usage<a class="headerlink" href="#example-usage" title="Permalink to this headline">¶</a></h3>
<p>Starting from the example given in <a class="reference internal" href="demod.html"><span class="doc">Computation of Demodulation Matrices</span></a> (assuming the <code class="docutils literal notranslate"><span class="pre">-S</span></code> option was used) we have</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ls -1
<span class="go">DEMOD.fits</span>
<span class="go">fitaux</span>
<span class="go">SoCC</span>
<span class="go">pac-pipeline</span>
</pre></div>
</div>
<p>From a little bit of testing I’d say that for fits of the CU parameters only (i.e., not fitting M3-6) the minimum number
of MCMC steps (for the default 256 walkers) is about 100. Furthermore, it takes about 50 steps before the walkers are
spread evenly across parameter space. Thus, let’s do</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> pac_mcmc -b <span class="m">50</span> -N <span class="m">150</span> fitaux
<span class="go">MCMCError.py:main_MCMC: found fits for 1 detector positions</span>
<span class="go">MCMCError.py:main_MCMC: analyzing position (0, 0) from fitaux/fitobj_00000000.pkl</span>
<span class="go">MCMCError.py:analyze_pickle:  starting MCMC analysis with keywords {&#39;burn&#39;: 50, &#39;nwalkers&#39;: 256, &#39;steps&#39;: 150}</span>
<span class="go">       x34       t34       x56       t56  ret0h_00  dreth_00 ret045_00 dret45_00  ret0r_00  dretr_00     chisq t_elapsed</span>
<span class="go">     1.018     3.613     0.924     3.196     1.550     1.048     2.349     0.753     1.118     0.750 1.362e+01     5.1 m</span>
<span class="go">MCMCError.py:run_MCMC: completed in 306.133 s</span>
<span class="go">MCMCError.py:analyze_pickle:  plotting results</span>
<span class="go">MCMCError.py:analyze_pickle:  saving results to fitaux/mcmcsav_00000000.pkl</span>
</pre></div>
</div>
<p>You’ll also see files called fitaux/mcmcsav_00000000_corner.pdf and fitaux/mcmcsav_00000000_traces.pdf. The first shows
an <a class="reference external" href="https://corner.readthedocs.io/en/latest/pages/quickstart.html">MCMC corner plot</a>, and the second a set of traces
for each parameter. The corner plot is useful for understanding the probability distribution for each parameter as well
as any correlations between parameters. The trace plot is useful for assessing if enough burn-in was done.</p>
</div>
</div>
<div class="section" id="demodulation-matrix-uncertainties">
<h2>Demodulation Matrix Uncertainties<a class="headerlink" href="#demodulation-matrix-uncertainties" title="Permalink to this headline">¶</a></h2>
<p>Some instrument pipelines might want uncertainty estimates on demodulation matrices for propagation of their own
uncertainty estimates. In this case the <code class="xref py py-obj docutils literal notranslate"><span class="pre">pac_demod_err</span></code> program offers a solution. It operates on the results of the
MCMC analysis described above, so make sure your MCMC analysis was good and complete. The calling sequence is</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">pac_demod_err [-h] [-s SUFFIX] [-t TELESCOPE_DB] [-p] data_dir demod_file output</span>
</pre></div>
</div>
<p>with options</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">data_dir:</th><td class="field-body">Directory containing a single Calibration Sequence. This is the same directory that was the input to <code class="xref py py-obj docutils literal notranslate"><span class="pre">pac_demod</span></code>.</td>
</tr>
<tr class="field-even field"><th class="field-name">demod_file:</th><td class="field-body">The Demodulation matrix file generated by <code class="xref py py-obj docutils literal notranslate"><span class="pre">pac_demod</span></code></td>
</tr>
<tr class="field-odd field"><th class="field-name">output:</th><td class="field-body">Location of FITS file in which to save uncertainty on <code class="docutils literal notranslate"><span class="pre">demod_file</span></code></td>
</tr>
<tr class="field-even field"><th class="field-name">-h:</th><td class="field-body">Display help text and exit</td>
</tr>
<tr class="field-odd field"><th class="field-name">-s SUFFIX:</th><td class="field-body">Control which files in <code class="docutils literal notranslate"><span class="pre">data_dir</span></code> are loaded. The file mask is <code class="docutils literal notranslate"><span class="pre">data_dir/*SUFFIX</span></code></td>
</tr>
<tr class="field-even field"><th class="field-name">-t FILE:</th><td class="field-body">Load Telescope Model parameters from the provided database. Defaults to <code class="docutils literal notranslate"><span class="pre">./telescope_db.txt</span></code></td>
</tr>
<tr class="field-odd field"><th class="field-name">-p:</th><td class="field-body">Generate plots showing the value distribution of each entry in the Demodulation matrices</td>
</tr>
</tbody>
</table>
<div class="section" id="id1">
<h3>Example Usage<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Starting where we left off above</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ls -1
<span class="go">DEMOD.fits</span>
<span class="go">fitaux</span>
<span class="go">SoCC</span>
<span class="go">pac-pipeline</span>
<span class="gp">$</span> pac_demod_err -t pac-pipeline/telescope_db.txt -p SoCC DEMOD.fits DEMOD_err.fits
<span class="go">MCMCError.py:main_demod_err: loaded polcal data from 10e-3</span>
<span class="go">MCMCError.py:main_demod_err: updating polarizer py value</span>
<span class="go">CUModel.py:set_py_from_database: py = 0.007555 at  620 nm</span>
<span class="go">MCMCError.py:main_demod_err: loading telescope database from ../../telescope_db.txt</span>
<span class="go">MCMCError.py:main_demod_err: found fits for 1 detector positions</span>
<span class="go">MCMCError.py:main_demod_err: computing err for position (0, 0)</span>
<span class="go">MCMCError.py:get_demod_stack: loaded MCMC results from SoCC/fitaux/mcmcsav_00000000.pkl</span>
<span class="go">MCMCError.py:get_demod_stack: reading MCMC steps: 10000/10000 (100%)</span>
<span class="go">MCMCError.py:plot_demod_err: generating demodulation uncertainty plot</span>
<span class="go">MCMCError.py:main_demod_err: saving plots to DEMOD_err.pdf</span>
</pre></div>
</div>
<p>“DEMOD_err.fits” has exactly the same format as “DEMOD.fits” and contains associated uncertainties. “DEMOD_err.pdf”
shows a probability distribution for each entry of the demodulation matrix.</p>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <div class="left-footer">
         &copy; 2019, Arthur Eigenbrot
       <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/80x15.png" /></a>
    </div>
   
    <div class="right-footer">
      Last updated on 09 Jan 2019.
    </div>
    <div class="centre-footer">
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.3
    </div>
  </div>
</footer>
  </body>
</html>